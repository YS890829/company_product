# 統合アーキテクチャ

## 調査日
2026-01-09

## 調査目的

テーマ1〜4の調査結果を統合し、ボイスメモアプリシステム全体のアーキテクチャを決定する。

---

## 1. 全体アーキテクチャ図

### 1.1 ハイレベルアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                             ボイスメモ 統合アーキテクチャ                               │
│                                                                                     │
│   ┌────────────────────────────────────────────────────────────────────────────┐   │
│   │                           クライアント層                                      │   │
│   │                                                                            │   │
│   │   ┌─────────────┐      ┌─────────────┐      ┌─────────────┐              │   │
│   │   │  iPhone     │      │   Web App   │      │  (将来)      │              │   │
│   │   │  App        │      │  (PWA)      │      │  Android    │              │   │
│   │   │  [Swift]    │      │  [React]    │      │             │              │   │
│   │   └──────┬──────┘      └──────┬──────┘      └──────┬──────┘              │   │
│   │          │                    │                    │                      │   │
│   └──────────┼────────────────────┼────────────────────┼──────────────────────┘   │
│              │                    │                    │                          │
│              └────────────────────┼────────────────────┘                          │
│                                   │                                               │
│                                   ▼                                               │
│   ┌────────────────────────────────────────────────────────────────────────────┐   │
│   │                        Google Cloud Platform                                │   │
│   │                                                                            │   │
│   │   ┌──────────────────────────────────────────────────────────────────┐    │   │
│   │   │                     Cloud Load Balancer                          │    │   │
│   │   └──────────────────────────────┬───────────────────────────────────┘    │   │
│   │                                  │                                        │   │
│   │   ┌──────────────────────────────▼───────────────────────────────────┐    │   │
│   │   │                      API Gateway (Cloud Run)                     │    │   │
│   │   │           ・認証 (JWT + Firebase Auth)                           │    │   │
│   │   │           ・ルーティング                                          │    │   │
│   │   │           ・レート制限                                            │    │   │
│   │   └──────────────────────────────┬───────────────────────────────────┘    │   │
│   │                                  │                                        │   │
│   │         ┌────────────────────────┼────────────────────────┐              │   │
│   │         │                        │                        │              │   │
│   │         ▼                        ▼                        ▼              │   │
│   │   ┌───────────┐           ┌───────────┐           ┌───────────┐          │   │
│   │   │ Recording │           │Transcription           │  Storage  │          │   │
│   │   │ Service   │──────────▶│ Service   │──────────▶│  Service  │          │   │
│   │   │(Cloud Run)│           │(Cloud Run)│           │(Cloud Run)│          │   │
│   │   └───────────┘           └─────┬─────┘           └─────┬─────┘          │   │
│   │                                 │                       │                │   │
│   │                                 ▼                       │                │   │
│   │                          ┌───────────┐                  │                │   │
│   │                          │  Search   │◀─────────────────┘                │   │
│   │                          │  Service  │                                   │   │
│   │                          │(Cloud Run)│                                   │   │
│   │                          └─────┬─────┘                                   │   │
│   │                                │                                         │   │
│   │   ┌────────────────────────────┼────────────────────────────────────┐    │   │
│   │   │                    Cloud Pub/Sub                                │    │   │
│   │   │         (イベント駆動: 文字起こし完了、分析完了)                    │    │   │
│   │   └────────────────────────────┬────────────────────────────────────┘    │   │
│   │                                │                                         │   │
│   │                                ▼                                         │   │
│   │                          ┌───────────┐                                   │   │
│   │                          │   CRM     │                                   │   │
│   │                          │  Gateway  │                                   │   │
│   │                          │(Cloud Run)│                                   │   │
│   │                          └─────┬─────┘                                   │   │
│   │                                │                                         │   │
│   └────────────────────────────────┼─────────────────────────────────────────┘   │
│                                    │                                             │
│                                    ▼                                             │
│   ┌────────────────────────────────────────────────────────────────────────────┐   │
│   │                   Revenue Intelligence Platform                             │   │
│   │                        (SFA/CRM システム)                                   │   │
│   └────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 データストア構成

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              データストア構成                                         │
│                                                                                     │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐                 │
│   │  Cloud Storage  │   │    Firestore    │   │  Chroma Cloud   │                 │
│   │     (GCS)       │   │                 │   │                 │                 │
│   │                 │   │                 │   │                 │                 │
│   │  ・音声ファイル  │   │  ・録音メタデータ │   │  ・ベクトル     │                 │
│   │  ・処理済み音声  │   │  ・ユーザー情報  │   │    エンベディング│                 │
│   │  ・バックアップ  │   │  ・処理状態     │   │  ・セマンティック│                 │
│   │                 │   │  ・設定         │   │    検索インデックス               │
│   └─────────────────┘   └─────────────────┘   └─────────────────┘                 │
│                                                                                     │
│   ┌─────────────────┐   ┌─────────────────┐                                       │
│   │  Secret Manager │   │   Cloud SQL     │                                       │
│   │                 │   │   (将来検討)    │                                       │
│   │  ・APIキー      │   │                 │                                       │
│   │  ・認証情報     │   │  ・リレーショナル│                                       │
│   │  ・証明書       │   │    データ（必要時）                                     │
│   └─────────────────┘   └─────────────────┘                                       │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 技術スタック一覧

### 2.1 フロントエンド

| カテゴリ | 技術 | バージョン | 用途 |
|---------|-----|----------|------|
| **iOS** | Swift + SwiftUI | 6.0+ | iPhone ネイティブアプリ |
| **iOS データ** | SwiftData | 6.0+ | ローカルデータ永続化 |
| **iOS 認証** | Keychain Services | - | 認証情報の安全な保存 |
| **Web** | React (TypeScript) | 19.x | Web版フロントエンド |
| **Web 状態管理** | Zustand | 5.x | 軽量状態管理 |
| **Web 録音** | MediaRecorder API | - | ブラウザ録音 |
| **Web ビルド** | Vite | 6.x | 高速ビルド |
| **Web PWA** | vite-plugin-pwa | 1.x | オフライン対応 |

### 2.2 バックエンド

| カテゴリ | 技術 | バージョン | 用途 |
|---------|-----|----------|------|
| **言語** | Python | 3.13+ | APIサービス |
| **フレームワーク** | FastAPI | 0.115+ | REST API |
| **ASGI** | Uvicorn | 0.34+ | 非同期サーバー |
| **バリデーション** | Pydantic | 2.x | データモデル |
| **非同期処理** | asyncio | - | 並行処理 |

### 2.3 AI/ML

| カテゴリ | 技術 | モデル | 用途 |
|---------|-----|-------|------|
| **文字起こし** | Gemini Audio API | Gemini 2.5 Flash | 音声→テキスト変換 |
| **構造化** | Gemini API | Gemini 2.5 Flash | JSON構造化、話者識別 |
| **要約** | Gemini API | Gemini 2.5 Flash | サマリー生成 |
| **エンベディング** | ChromaDB | text-embedding-3-small | ベクトル化 |

### 2.4 インフラストラクチャ

| カテゴリ | 技術 | 用途 |
|---------|-----|------|
| **コンピューティング** | Cloud Run | サーバーレスコンテナ |
| **ロードバランサー** | Cloud Load Balancing | トラフィック分散 |
| **メッセージング** | Cloud Pub/Sub | 非同期イベント |
| **ストレージ** | Cloud Storage (GCS) | 音声ファイル保存 |
| **データベース** | Firestore | NoSQL メタデータ |
| **ベクトルDB** | Chroma Cloud | セマンティック検索 |
| **認証** | Firebase Auth | ユーザー認証 |
| **シークレット** | Secret Manager | APIキー管理 |
| **コンテナ** | Artifact Registry | イメージ管理 |

### 2.5 開発・運用

| カテゴリ | 技術 | 用途 |
|---------|-----|------|
| **CI** | GitHub Actions | 自動ビルド・テスト |
| **CD** | Cloud Build | 自動デプロイ |
| **モニタリング** | Cloud Monitoring | メトリクス監視 |
| **トレーシング** | Cloud Trace | 分散トレーシング |
| **ロギング** | Cloud Logging | 構造化ログ |
| **アラート** | Cloud Alerting | 異常検知通知 |

---

## 3. データフロー図

### 3.1 録音〜文字起こしフロー

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          録音〜文字起こしデータフロー                                   │
│                                                                                     │
│  ① 録音開始                                                                         │
│  ┌──────────┐                                                                       │
│  │ Client   │──録音──▶ ローカル音声データ                                            │
│  │ (iPhone/ │         (m4a / webm)                                                 │
│  │  Web)    │                                                                       │
│  └──────────┘                                                                       │
│       │                                                                             │
│       │ ② アップロード (REST + JWT)                                                  │
│       │    POST /api/v2/recordings                                                  │
│       ▼                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐              │
│  │                         Recording Service                         │              │
│  │  ・音声ファイル受信                                                │              │
│  │  ・メタデータ保存 (Firestore)                                      │              │
│  │  ・音声ファイル保存 (GCS)                                          │              │
│  │  ・処理ジョブ発行 (Pub/Sub)                                        │              │
│  └──────────────────────────────────────────────────────────────────┘              │
│       │                                                                             │
│       │ ③ 処理ジョブ通知 (Pub/Sub)                                                  │
│       │    topic: transcription-jobs                                                │
│       ▼                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐              │
│  │                       Transcription Service                       │              │
│  │  ・音声ファイル取得 (GCS)                                          │              │
│  │  ・Gemini Audio API 呼び出し                                       │              │
│  │  ・話者識別・構造化                                                │              │
│  │  ・要約生成                                                       │              │
│  └──────────────────────────────────────────────────────────────────┘              │
│       │                                                                             │
│       │ ④ 処理結果保存                                                              │
│       ▼                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐              │
│  │                         Storage Service                           │              │
│  │  ・文字起こし結果保存 (Firestore)                                   │              │
│  │  ・エンベディング生成・保存 (Chroma Cloud)                          │              │
│  │  ・処理完了通知発行 (Pub/Sub)                                      │              │
│  └──────────────────────────────────────────────────────────────────┘              │
│       │                                                                             │
│       │ ⑤ 完了通知 (Pub/Sub)                                                        │
│       │    topic: transcription-completed                                           │
│       ├───────────────────────────────────────────────────────┐                    │
│       │                                                       │                    │
│       ▼                                                       ▼                    │
│  ┌──────────┐                                          ┌───────────┐              │
│  │ Client   │◀───プッシュ通知 / ポーリング────          │   CRM     │              │
│  │          │    結果表示                               │  Gateway  │              │
│  └──────────┘                                          └───────────┘              │
│                                                              │                      │
│                                                              │ ⑥ SFA/CRM連携       │
│                                                              │    (Webhook)         │
│                                                              ▼                      │
│                                                   ┌────────────────────┐           │
│                                                   │ Revenue Intelligence│           │
│                                                   │     Platform        │           │
│                                                   └────────────────────┘           │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 検索フロー

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              検索データフロー                                         │
│                                                                                     │
│  ┌──────────┐                                                                       │
│  │ Client   │                                                                       │
│  └────┬─────┘                                                                       │
│       │                                                                             │
│       │ ① 検索クエリ (REST)                                                         │
│       │    GET /api/v2/search?q=検索キーワード                                       │
│       ▼                                                                             │
│  ┌──────────────────────────────────────────────────────────────────┐              │
│  │                          Search Service                           │              │
│  │                                                                   │              │
│  │  ┌─────────────────────┐    ┌─────────────────────┐             │              │
│  │  │ セマンティック検索   │    │    全文検索         │             │              │
│  │  │ (Chroma Cloud)      │    │    (Firestore)      │             │              │
│  │  └──────────┬──────────┘    └──────────┬──────────┘             │              │
│  │             │                          │                        │              │
│  │             └──────────┬───────────────┘                        │              │
│  │                        │                                        │              │
│  │                        ▼                                        │              │
│  │              ┌─────────────────────┐                           │              │
│  │              │   結果マージ・       │                           │              │
│  │              │   ランキング         │                           │              │
│  │              └─────────────────────┘                           │              │
│  │                                                                   │              │
│  └──────────────────────────────────────────────────────────────────┘              │
│       │                                                                             │
│       │ ② 検索結果 (JSON)                                                           │
│       ▼                                                                             │
│  ┌──────────┐                                                                       │
│  │ Client   │                                                                       │
│  └──────────┘                                                                       │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 実装ロードマップ

### 4.1 フェーズ概要

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              実装ロードマップ                                         │
│                                                                                     │
│  2026 Q1          2026 Q2          2026 Q3          2026 Q4          2027 Q1       │
│  ──────────────────────────────────────────────────────────────────────────────     │
│                                                                                     │
│  ┌─────────────┐                                                                    │
│  │  Phase 1    │                                                                    │
│  │ iOS基盤構築 │                                                                    │
│  └─────────────┘                                                                    │
│       │                                                                             │
│       └──▶ ┌─────────────┐                                                          │
│            │  Phase 2    │                                                          │
│            │ クラウド移行 │                                                          │
│            └─────────────┘                                                          │
│                 │                                                                   │
│                 └──▶ ┌─────────────┐                                                │
│                      │  Phase 3    │                                                │
│                      │ Web版開発   │                                                │
│                      └─────────────┘                                                │
│                           │                                                         │
│                           └──▶ ┌─────────────┐                                      │
│                                │  Phase 4    │                                      │
│                                │ CRM連携     │                                      │
│                                └─────────────┘                                      │
│                                     │                                               │
│                                     └──▶ ┌─────────────┐                            │
│                                          │  Phase 5    │                            │
│                                          │ 最適化      │                            │
│                                          └─────────────┘                            │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 Phase 1: iOS基盤構築（2026 Q1）

**目標**: iPhoneアプリの基盤機能を完成させる

| ステージ | タスク | 成果物 |
|---------|-------|--------|
| **1-A** | SwiftData導入 | 録音データモデル、永続化層 |
| **1-B** | Keychain認証 | APIキー・認証情報の安全な保存 |
| **1-C** | 設定画面 | サーバーURL、認証設定UI |
| **1-D** | 録音機能 | 高品質録音、バックグラウンド対応 |
| **1-E** | ローカル動作確認 | Mac上のstructured_transcriberとの連携テスト |

**マイルストーン**: iPhoneアプリが録音→Mac連携→結果表示まで動作

### 4.3 Phase 2: クラウド移行（2026 Q2）

**目標**: structured_transcriberをGoogle Cloudへ移行

| ステージ | タスク | 成果物 |
|---------|-------|--------|
| **2-A** | GCPプロジェクト設定 | プロジェクト、IAM、ネットワーク構成 |
| **2-B** | Cloud Run デプロイ | Transcription Service、Storage Service |
| **2-C** | データストア構築 | GCS、Firestore、Chroma Cloud設定 |
| **2-D** | API Gateway構築 | 認証、ルーティング、レート制限 |
| **2-E** | iOSアプリ接続先変更 | ローカル→クラウドエンドポイント |
| **2-F** | モニタリング設定 | Cloud Trace、Cloud Monitoring、アラート |

**マイルストーン**: iPhoneアプリがクラウド経由で動作

### 4.4 Phase 3: Web版開発（2026 Q3）

**目標**: Mac/Windows対応のWeb録音アプリを開発

| ステージ | タスク | 成果物 |
|---------|-------|--------|
| **3-A** | React プロジェクト設定 | Vite + TypeScript + PWA設定 |
| **3-B** | 録音UI実装 | MediaRecorder API統合 |
| **3-C** | 認証統合 | Firebase Auth連携 |
| **3-D** | API連携 | 録音アップロード、結果取得 |
| **3-E** | オフライン対応 | Service Worker、IndexedDB |
| **3-F** | PWA最適化 | インストール、バックグラウンド同期 |

**マイルストーン**: Web版がPWAとしてMac/Windowsで動作

### 4.5 Phase 4: SFA/CRM連携（2026 Q4）

**目標**: revenue-intelligence-platformとの連携を実現

| ステージ | タスク | 成果物 |
|---------|-------|--------|
| **4-A** | CRM Gateway開発 | Webhook受信、データ変換 |
| **4-B** | API v2エンドポイント追加 | revenue-intelligence-platform側 |
| **4-C** | 連携テスト | E2Eテスト、データ整合性検証 |
| **4-D** | エラーハンドリング | リトライ、Circuit Breaker実装 |
| **4-E** | モニタリング拡張 | 連携エラー監視、アラート |

**マイルストーン**: 文字起こし完了→自動でCRM反映

### 4.6 Phase 5: 最適化・拡張（2027 Q1〜）

**目標**: パフォーマンス最適化と機能拡張

| ステージ | タスク | 成果物 |
|---------|-------|--------|
| **5-A** | パフォーマンス最適化 | コールドスタート対策、キャッシュ |
| **5-B** | gRPC移行検討 | 内部通信の高速化 |
| **5-C** | 高度な検索機能 | フィルタリング、ファセット検索 |
| **5-D** | 分析ダッシュボード | 利用統計、AI分析結果可視化 |
| **5-E** | マルチテナント対応 | 組織・チーム機能 |

---

## 5. コスト見積もり

### 5.1 想定利用量

| 項目 | 初期（10ユーザー） | 成長期（50ユーザー） | 本格運用（200ユーザー） |
|------|------------------|-------------------|---------------------|
| 月間録音件数 | 100件 | 500件 | 2,000件 |
| 平均録音時間 | 30分 | 30分 | 30分 |
| 月間音声時間 | 50時間 | 250時間 | 1,000時間 |
| ストレージ | 50GB | 250GB | 1TB |

### 5.2 月額コスト見積もり

#### 初期（10ユーザー）

| サービス | 用途 | 月額目安 |
|---------|------|---------|
| Cloud Run | API + 処理 | $5-20 |
| Cloud Storage | 音声ファイル 50GB | $1-2 |
| Firestore | メタデータ | $0-5 |
| Chroma Cloud | ベクトル検索 | $0-5 (無料枠) |
| Cloud Pub/Sub | メッセージング | $0-1 |
| Gemini API | 文字起こし 50時間 | $10-30 |
| Secret Manager | シークレット管理 | $0-1 |
| **合計** | | **$16-64/月** |

#### 成長期（50ユーザー）

| サービス | 用途 | 月額目安 |
|---------|------|---------|
| Cloud Run | スケールアップ | $30-80 |
| Cloud Storage | 250GB | $5-10 |
| Firestore | 増加 | $5-15 |
| Chroma Cloud | 有料プラン | $10-30 |
| Cloud Pub/Sub | メッセージ増加 | $2-5 |
| Gemini API | 250時間 | $50-150 |
| Secret Manager | - | $1 |
| Cloud Monitoring | 監視強化 | $5-10 |
| **合計** | | **$108-301/月** |

#### 本格運用（200ユーザー）

| サービス | 用途 | 月額目安 |
|---------|------|---------|
| Cloud Run | 高負荷対応 | $100-300 |
| Cloud Storage | 1TB | $20-30 |
| Firestore | 大規模 | $30-60 |
| Chroma Cloud | エンタープライズ | $50-100 |
| Cloud Pub/Sub | 高スループット | $10-20 |
| Gemini API | 1,000時間 | $200-600 |
| Secret Manager | - | $2-5 |
| Cloud Monitoring | フル監視 | $20-50 |
| Cloud SQL (検討) | リレーショナル | $50-100 |
| **合計** | | **$482-1,265/月** |

### 5.3 初期費用

| 項目 | 費用 |
|------|------|
| GCP 新規クレジット | -$300 (約6-18ヶ月分相当) |
| ドメイン取得 | $10-50/年 |
| SSL証明書 | $0 (Let's Encrypt) |
| 開発環境 | $0 (既存利用) |

### 5.4 コスト最適化戦略

| 戦略 | 効果 |
|------|------|
| **スケール to ゼロ** | アイドル時0円 |
| **Gemini Flash** | Pro比で大幅コスト削減 |
| **圧縮音声フォーマット** | ストレージ削減 |
| **キャッシュ活用** | API呼び出し削減 |
| **確約利用割引** | 長期運用時10-30%削減 |

---

## 6. リスクと対策

### 6.1 技術リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|-------|---------|------|
| **Gemini API障害** | 高 | 低 | フォールバック先（OpenAI Whisper）の準備、リトライ戦略 |
| **コールドスタート遅延** | 中 | 高 | 最小インスタンス=1設定、ウォームアップ処理 |
| **ChromaDB性能限界** | 中 | 低 | シャーディング計画、Pinecone/Weaviate移行検討 |
| **Safari録音互換性** | 中 | 中 | ポリフィル準備、WAV形式サポート |
| **データ不整合** | 高 | 中 | 冪等性キー必須、Saga パターン検討 |

### 6.2 運用リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|-------|---------|------|
| **コスト急増** | 高 | 中 | 予算アラート設定、利用量上限設定 |
| **セキュリティ侵害** | 高 | 低 | WAF導入、定期脆弱性スキャン、IAM最小権限 |
| **データ喪失** | 高 | 低 | マルチリージョンバックアップ、バージョニング有効化 |
| **サービス停止** | 高 | 低 | SLA監視、ヘルスチェック、自動復旧設定 |

### 6.3 ビジネスリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|-------|---------|------|
| **Gemini API価格改定** | 中 | 中 | コスト予測に余裕を持つ、代替API調査 |
| **プライバシー規制強化** | 中 | 中 | GDPR対応設計、データ保持ポリシー策定 |
| **競合サービス出現** | 低 | 高 | 差別化機能（CRM連携）強化、ユーザー体験向上 |

### 6.4 リスクマトリクス

```
           高   ┌──────────────────────────────────────┐
               │                      │  Gemini障害   │
               │                      │  データ喪失   │
               │                      │  セキュリティ  │
           影   │                      │               │
           響   ├──────────────────────┼───────────────┤
           度   │  コスト急増          │  データ不整合 │
               │  Safari互換性        │               │
               │                      │               │
               ├──────────────────────┼───────────────┤
               │  ChromaDB限界        │  コールドスタート│
               │  価格改定            │               │
           低   │                      │               │
               └──────────────────────┴───────────────┘
                          低              高
                            発生確率
```

---

## 7. 各テーマ決定事項の統合

### 7.1 テーマ1: マルチプラットフォーム対応

| 決定事項 | 統合アーキテクチャでの位置付け |
|---------|---------------------------|
| React + PWA | Web版フロントエンドの標準技術 |
| MediaRecorder API | ブラウザ録音の統一インターフェース |
| Service Worker + IndexedDB | オフライン対応の基盤 |
| Tauri（将来検討） | デスクトップネイティブ化オプション |

### 7.2 テーマ2: サーバー移行計画

| 決定事項 | 統合アーキテクチャでの位置付け |
|---------|---------------------------|
| Google Cloud | 全サービスのホスティング基盤 |
| Cloud Run | 全マイクロサービスの実行環境 |
| GCS | 音声ファイルストレージ |
| Firestore | メタデータ・状態管理 |
| Chroma Cloud | ベクトル検索インフラ |

### 7.3 テーマ3: SFA/CRM連携

| 決定事項 | 統合アーキテクチャでの位置付け |
|---------|---------------------------|
| REST API + Webhook | サービス間連携の標準方式 |
| API Key + JWT | 認証方式（段階的拡張） |
| Exponential Backoff | エラーハンドリング標準 |
| 冪等性キー | データ整合性保証 |

### 7.4 テーマ4: マイクロサービス設計

| 決定事項 | 統合アーキテクチャでの位置付け |
|---------|---------------------------|
| 5サービス構成 | API Gateway, Transcription, Storage, Search, CRM Gateway |
| Cloud Pub/Sub | 非同期通信基盤 |
| Database Per Service | データ分離の原則 |
| Cloud Run First | スケーラビリティ戦略 |

---

## 8. 残課題一覧（優先度順）

### 8.1 高優先度

| # | 課題 | 関連テーマ | 対応時期 |
|---|------|----------|---------|
| 1 | **API Gateway実装方式の最終決定** | マイクロサービス | Phase 2 |
| 2 | **Gemini API詳細コスト検証** | サーバー移行 | Phase 2 |
| 3 | **Safari MediaRecorder互換性テスト** | マルチプラットフォーム | Phase 3 |
| 4 | **Webhook署名検証実装** | SFA/CRM連携 | Phase 4 |

### 8.2 中優先度

| # | 課題 | 関連テーマ | 対応時期 |
|---|------|----------|---------|
| 5 | サービス間認証詳細設計 | マイクロサービス | Phase 2 |
| 6 | コールドスタート対策の費用対効果分析 | サーバー移行 | Phase 2 |
| 7 | React状態管理ライブラリ最終選定 | マルチプラットフォーム | Phase 3 |
| 8 | レート制限設計 | SFA/CRM連携 | Phase 4 |

### 8.3 低優先度

| # | 課題 | 関連テーマ | 対応時期 |
|---|------|----------|---------|
| 9 | gRPC移行計画 | マイクロサービス | Phase 5 |
| 10 | Sagaパターン必要性評価 | マイクロサービス | Phase 5 |
| 11 | iOS/Web UI/UX統一ガイドライン | マルチプラットフォーム | Phase 5 |
| 12 | GDPR対応詳細設計 | SFA/CRM連携 | Phase 5 |

---

## 9. 結論

### 9.1 アーキテクチャ方針

**「Cloud Run First + 段階的拡張」アプローチを採用**

1. **シンプルさ優先**: Cloud Runによるサーバーレス構成で開始
2. **段階的移行**: ローカル→クラウド→マルチプラットフォーム→CRM連携
3. **コスト効率**: 使用量課金でスモールスタート
4. **将来の拡張性**: GKE移行パスを確保

### 9.2 技術選定根拠

| 選定 | 根拠 |
|------|------|
| **Google Cloud** | Gemini APIとの親和性、無料枠の充実 |
| **Cloud Run** | 運用負荷最小、コスト効率、自動スケール |
| **React + PWA** | 開発効率、マルチプラットフォーム対応 |
| **REST + Webhook** | シンプルさ、既存システム互換性 |
| **Firestore** | スキーマレス、リアルタイム同期 |

### 9.3 成功指標

| フェーズ | 成功指標 |
|---------|---------|
| Phase 1 | iPhoneアプリがローカルバックエンドと連携動作 |
| Phase 2 | 月額コスト $50以下で10ユーザー対応 |
| Phase 3 | Web版がChrome/Safari/Edgeで動作 |
| Phase 4 | 文字起こし→CRM反映が5分以内 |
| Phase 5 | P99レイテンシ 3秒以内 |

---

## 参考資料

### 調査ドキュメント

- [01_multiplatform.md](./01_multiplatform.md) - マルチプラットフォーム対応調査
- [02_server_migration.md](./02_server_migration.md) - サーバー移行計画調査
- [03_sfa_crm_integration.md](./03_sfa_crm_integration.md) - SFA/CRM連携調査
- [04_microservices.md](./04_microservices.md) - マイクロサービス設計調査

### 関連リソース

- [ARCHITECTURE_DECISION.md](./ARCHITECTURE_DECISION.md) - アーキテクチャ決定事項
- [RESEARCH_PLAN.md](./RESEARCH_PLAN.md) - 調査プラン

---

**作成日**: 2026-01-09
**最終更新**: 2026-01-09
**ステータス**: ✅ 完了
