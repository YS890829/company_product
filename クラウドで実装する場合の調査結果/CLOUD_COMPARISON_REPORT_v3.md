# クラウドサービス比較検討レポート v3

**作成日**: 2026-01-06
**更新日**: 2026-01-06
**目的**: ボイスメモ文字起こしシステムの最適なクラウド構成を選定

---

## 1. 要件サマリー（v3）

### 1.1 利用規模

| 年度 | ユーザー数 | 月間音声時間 | 月間ファイル数 | 1件あたり |
|-----|----------|------------|--------------|----------|
| 2026年 | 31名 | 3,100時間 | 約3,100件 | 60分 |
| 2027年 | 68名 | 6,800時間 | 約6,800件 | 60分 |

### 1.2 デバイス構成

| デバイス | 比率 | 月間ファイル数(2026) | クライアント形態 |
|---------|-----|---------------------|-----------------|
| iPhone | 50% | 1,550件 | ネイティブアプリ |
| PC | 50% | 1,550件 | Webアプリ（ブラウザ） |

### 1.3 v3の前提条件（v2との違い）

| 項目 | v2 | v3 |
|-----|----|----|
| アプリ構成 | 統合プロジェクト | **iPhone / Web を別プロジェクトで開発** |
| バックエンド | 共通 | **共通 or 別々（選択可）** |
| 開発チーム | 同一 | **別チームの可能性あり** |

---

## 2. アーキテクチャ選択肢

### 2.1 パターン比較

| パターン | 構成 | メリット | デメリット |
|---------|------|---------|-----------|
| **A: 完全分離** | iPhone専用 + Web専用 | 独立開発、相互影響なし | コスト重複、データ分断 |
| **B: バックエンド共通** | 別クライアント + 共通処理基盤 | コスト効率、データ統合 | 共通部分の調整必要 |
| **C: ストレージ共通** | 別クライアント + 共通Storage + 別処理 | 柔軟性高 | 中途半端 |

### 2.2 推奨パターン

**パターンB: バックエンド共通** を推奨

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        推奨アーキテクチャ v3                                │
│                     「クライアント別開発 + バックエンド共通」                │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────┐
                    │         共通バックエンド             │
                    │                                     │
┌─────────────────┐ │  ┌─────────────────────────────┐   │
│    iPhone       │ │  │     Cloud Storage           │   │
│  VoiceMemoApp   │─┼─▶│     (音声保存)              │   │
│                 │ │  └──────────────┬──────────────┘   │
│  独自SDK選定可  │ │                 │                  │
└─────────────────┘ │                 ▼                  │
                    │  ┌─────────────────────────────┐   │
┌─────────────────┐ │  │     処理エンジン            │   │
│    Web App      │ │  │     (Cloud Run)             │   │
│  (React等)      │─┼─▶│                             │   │
│                 │ │  │  • Gemini API               │   │
│  独自SDK選定可  │ │  │  • 文字起こし処理           │   │
└─────────────────┘ │  └──────────────┬──────────────┘   │
                    │                 │                  │
                    │                 ▼                  │
                    │  ┌─────────────────────────────┐   │
                    │  │     Cloud Storage           │   │
                    │  │     (結果保存)              │   │
                    │  └─────────────────────────────┘   │
                    └─────────────────────────────────────┘
```

---

## 3. iPhoneアプリ向けクラウド構成

### 3.1 選択肢比較

| 構成 | アップロード方式 | 認証 | 実装難度 | コスト |
|-----|-----------------|------|---------|-------|
| **Firebase Storage** | Firebase iOS SDK | Firebase Auth | ◎ 最低 | ○ |
| **GCP Storage + 署名付きURL** | REST API | 独自 or Firebase Auth | ○ 中 | ○ |
| **AWS S3 + 署名付きURL** | REST API | Cognito | ○ 中 | ○ |
| **AWS S3 + Amplify** | Amplify SDK | Cognito | ○ 中 | ○ |

### 3.2 推奨: Firebase Storage

| 項目 | 内容 |
|-----|------|
| **ストレージ** | Firebase Storage (Cloud Storage for Firebase) |
| **SDK** | Firebase iOS SDK |
| **認証** | Firebase Auth |
| **アップロード** | resumable upload（大容量対応） |

#### 選定理由

| 理由 | 詳細 |
|-----|------|
| **SDK成熟度** | Firebase iOS SDKはSwiftUI対応が最も充実 |
| **実装コスト** | 数行のコードでアップロード完了 |
| **認証統合** | Firebase Authとシームレス連携 |
| **進捗管理** | アップロード進捗の監視が容易 |
| **オフライン対応** | SDKがリトライ・再開を自動処理 |

#### コード例（Swift）

```swift
// Firebase Storage アップロード
let storageRef = Storage.storage().reference()
let audioRef = storageRef.child("audio/\(userId)/\(fileName).m4a")

let uploadTask = audioRef.putFile(from: localFileURL) { metadata, error in
    if let error = error {
        print("Upload failed: \(error)")
        return
    }
    print("Upload complete")
}

// 進捗監視
uploadTask.observe(.progress) { snapshot in
    let progress = Double(snapshot.progress!.completedUnitCount)
                 / Double(snapshot.progress!.totalUnitCount)
    print("Progress: \(progress * 100)%")
}
```

### 3.3 iPhoneアプリ構成図

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         iPhoneアプリ構成                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────┐
│         iPhone App                  │
│         (SwiftUI)                   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Firebase iOS SDK           │   │
│  │  • FirebaseAuth             │   │
│  │  • FirebaseStorage          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  AVFoundation               │   │
│  │  • 録音 (m4a/AAC)           │   │
│  └─────────────────────────────┘   │
└──────────────────┬──────────────────┘
                   │
                   │ Firebase SDK
                   ▼
┌─────────────────────────────────────┐
│  Firebase Auth                      │
│  (ユーザー認証)                     │
└─────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│  Firebase Storage                   │
│  (共通バックエンドへ)               │
└─────────────────────────────────────┘
```

---

## 4. Webアプリ向けクラウド構成

### 4.1 選択肢比較

| 構成 | アップロード方式 | 認証 | 実装難度 | コスト |
|-----|-----------------|------|---------|-------|
| **Firebase Storage** | Firebase Web SDK | Firebase Auth | ◎ 最低 | ○ |
| **GCP Storage + 署名付きURL** | REST API | 独自 or Firebase Auth | ○ 中 | ○ |
| **AWS S3 + 署名付きURL** | REST API | Cognito | ○ 中 | ○ |
| **Cloudflare R2** | REST API | 独自 | ○ 中 | ◎ 最安 |
| **Supabase Storage** | Supabase SDK | Supabase Auth | ◎ 低 | ○ |

### 4.2 推奨: Firebase Storage（iPhoneと共通）

| 項目 | 内容 |
|-----|------|
| **ストレージ** | Firebase Storage |
| **SDK** | Firebase Web SDK (JavaScript) |
| **認証** | Firebase Auth |
| **フレームワーク** | React / Next.js |
| **録音** | MediaRecorder API (WebM/Opus) |

#### 選定理由

| 理由 | 詳細 |
|-----|------|
| **iPhoneと共通** | 同一Storageでデータ統合 |
| **SDK充実** | Firebase Web SDKも成熟 |
| **認証共通** | 同一Firebase Authでユーザー管理統一 |
| **処理基盤共通** | Cloud Run側の改修不要 |

### 4.3 代替案: Supabase（完全独立の場合）

iPhoneアプリと**完全に別プロジェクト**にする場合の選択肢:

| 項目 | 内容 |
|-----|------|
| **ストレージ** | Supabase Storage |
| **認証** | Supabase Auth |
| **DB** | Supabase (PostgreSQL) |
| **処理** | Supabase Edge Functions or 別途Cloud Run |

#### Supabaseのメリット

| メリット | 詳細 |
|---------|------|
| **オールインワン** | Storage + Auth + DB が統合 |
| **PostgreSQL** | RDBが標準で付属 |
| **無料枠大きい** | 500MB Storage、50,000 MAU |
| **開発体験** | DXが良い |

#### Supabaseのデメリット

| デメリット | 詳細 |
|-----------|------|
| **処理時間制限** | Edge Functions は実行時間制限あり |
| **Gemini連携** | 追加実装必要 |
| **iPhoneと分断** | データ統合に追加作業必要 |

### 4.4 Webアプリ構成図

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Webアプリ構成                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────┐
│         Web App                     │
│         (React / Next.js)           │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  Firebase Web SDK           │   │
│  │  • firebase/auth            │   │
│  │  • firebase/storage         │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  MediaRecorder API          │   │
│  │  • 録音 (WebM/Opus)         │   │
│  └─────────────────────────────┘   │
└──────────────────┬──────────────────┘
                   │
                   │ Firebase SDK
                   ▼
┌─────────────────────────────────────┐
│  Firebase Auth                      │
│  (ユーザー認証 - iPhoneと共通)      │
└─────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│  Firebase Storage                   │
│  (共通バックエンドへ - iPhoneと共通)│
└─────────────────────────────────────┘
```

---

## 5. 共通バックエンド構成

### 5.1 処理エンジン: Cloud Run

| 項目 | 内容 |
|-----|------|
| **サービス** | Cloud Run |
| **タイムアウト** | 60分（60分音声に対応） |
| **トリガー** | Eventarc (Storage イベント) |
| **処理内容** | 音声取得 → Gemini API → 結果保存 |

### 5.2 構成図

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         共通バックエンド構成                                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────┐
│  Firebase Storage                   │
│                                     │
│  📁 audio/                          │
│     └── {userId}/                   │
│         ├── 2026-01-05_143022.m4a  │  ← iPhone
│         └── 2026-01-05_150000.webm │  ← Web
└──────────────────┬──────────────────┘
                   │
                   │ Eventarc (自動トリガー)
                   ▼
┌─────────────────────────────────────┐
│  Cloud Run                          │
│                                     │
│  処理フロー:                        │
│  1. Storage から音声取得            │
│  2. フォーマット判定 (m4a/webm)     │
│  3. Gemini API 呼び出し             │
│  4. 構造化処理                      │
│  5. 結果を Storage 保存             │
│                                     │
│  タイムアウト: 60分                 │
└──────────────────┬──────────────────┘
                   │
                   ▼
┌─────────────────────────────────────┐
│  Firebase Storage                   │
│                                     │
│  📁 transcripts/                    │
│     └── {userId}/                   │
│         ├── 2026-01-05_143022.json │
│         └── 2026-01-05_150000.json │
└─────────────────────────────────────┘
```

---

## 6. コスト試算

### 6.1 共通バックエンド（Cloud Run + Storage）

| 項目 | 単価 | 使用量 | 月額(2026) |
|-----|------|-------|-----------|
| Firebase Storage | $0.026/GB | 300GB | $7.8 |
| Cloud Run (CPU) | $0.00002400/vCPU-秒 | 1vCPU × 600秒 × 3,100 | $44.6 |
| Cloud Run (メモリ) | $0.00000250/GB-秒 | 2GB × 600秒 × 3,100 | $9.3 |
| Eventarc | $0.10/100万 | 3,100 | $0.0003 |
| Egress | $0.12/GB | 100GB | $12 |
| **インフラ小計** | | | **$74** |
| Gemini API | $0.01-0.03/分 | 3,100時間 | $19-56 |
| **合計** | | | **$93-130/月** |

### 6.2 クライアント別追加コスト

| クライアント | 追加コスト | 内訳 |
|------------|-----------|------|
| iPhoneアプリ | $0 | Firebase SDK利用は無料 |
| Webアプリ | $0 | Firebase SDK利用は無料 |
| **合計** | **$0** | |

### 6.3 年間コスト見積もり

| 年度 | 月額 | 年額 |
|-----|------|------|
| 2026年 | $93-130 | **$1,116-1,560** |
| 2027年 | $186-260 | **$2,232-3,120** |

---

## 7. 開発工数比較

### 7.1 パターン別工数

| パターン | iPhone | Web | バックエンド | 合計 |
|---------|--------|-----|-------------|------|
| **A: 完全分離** | 2週間 | 3週間 | 2週間×2 | **9週間** |
| **B: バックエンド共通（推奨）** | 2週間 | 3週間 | 2週間 | **7週間** |
| **C: ストレージ共通** | 2週間 | 3週間 | 1.5週間×2 | **8週間** |

### 7.2 推奨パターンの詳細工数

| フェーズ | 作業内容 | 工数 |
|---------|---------|------|
| **Phase 1** | Firebase + Cloud Run セットアップ | 3日 |
| **Phase 2** | Cloud Run 処理エンジン実装 | 1週間 |
| **Phase 3** | iPhoneアプリ改修 | 2週間 |
| **Phase 4** | Webアプリ新規開発 | 3週間 |
| **合計** | | **約7週間** |

---

## 8. 総合評価

### 8.1 構成パターン評価

| 項目 | 重み | 完全分離 | バックエンド共通 | ストレージ共通 |
|-----|-----|---------|-----------------|---------------|
| コスト効率 | 25% | 2 | 5 | 4 |
| 開発工数 | 25% | 2 | 5 | 3 |
| 独立性 | 20% | 5 | 4 | 4 |
| データ統合 | 15% | 1 | 5 | 3 |
| 保守性 | 15% | 3 | 4 | 3 |
| **合計** | 100% | **2.5** | **4.65** | **3.45** |

### 8.2 クラウドサービス評価（バックエンド共通パターン）

| 項目 | 重み | Firebase+Run | Supabase+Run | AWS統合 |
|-----|-----|--------------|--------------|---------|
| 60分処理対応 | 25% | 5 | 4 | 5 |
| マルチプラットフォームSDK | 20% | 5 | 4 | 3 |
| Gemini親和性 | 20% | 5 | 3 | 3 |
| コスト | 15% | 4 | 4 | 4 |
| 実装シンプルさ | 10% | 5 | 4 | 3 |
| 独立開発のしやすさ | 10% | 4 | 5 | 3 |
| **合計** | 100% | **4.75** | **3.9** | **3.55** |

---

## 9. 最終推奨構成

### 9.1 推奨: Firebase + Cloud Run（バックエンド共通）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           最終推奨アーキテクチャ                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐                           ┌─────────────────┐
│    iPhone       │                           │    Web App      │
│  VoiceMemoApp   │                           │  (React/Next)   │
│                 │                           │                 │
│  ┌───────────┐  │                           │  ┌───────────┐  │
│  │ Firebase  │  │                           │  │ Firebase  │  │
│  │ iOS SDK   │  │                           │  │ Web SDK   │  │
│  └───────────┘  │                           │  └───────────┘  │
│                 │                           │                 │
│  📱 独立開発    │                           │  💻 独立開発    │
└────────┬────────┘                           └────────┬────────┘
         │                                             │
         │  Firebase SDK                  Firebase SDK │
         │                                             │
         └──────────────────┬──────────────────────────┘
                            │
                            ▼
         ┌─────────────────────────────────────────────┐
         │              Firebase Auth                  │
         │           (共通ユーザー管理)                │
         └─────────────────────────────────────────────┘
                            │
                            ▼
         ┌─────────────────────────────────────────────┐
         │            Firebase Storage                 │
         │                                             │
         │  📁 audio/{userId}/                         │
         │     ├── *.m4a (iPhone)                     │
         │     └── *.webm (Web)                       │
         └──────────────────┬──────────────────────────┘
                            │
                            │ Eventarc
                            ▼
         ┌─────────────────────────────────────────────┐
         │              Cloud Run                      │
         │                                             │
         │  • 60分タイムアウト                         │
         │  • m4a / webm 両対応                       │
         │  • Gemini API 文字起こし                   │
         └──────────────────┬──────────────────────────┘
                            │
                            ▼
         ┌─────────────────────────────────────────────┐
         │            Firebase Storage                 │
         │                                             │
         │  📁 transcripts/{userId}/                   │
         │     └── *.json                             │
         └─────────────────────────────────────────────┘
```

### 9.2 各アプリの技術スタック

| 項目 | iPhoneアプリ | Webアプリ |
|-----|-------------|----------|
| **言語** | Swift | TypeScript |
| **UI** | SwiftUI | React / Next.js |
| **認証SDK** | FirebaseAuth iOS | firebase/auth |
| **StorageSDK** | FirebaseStorage iOS | firebase/storage |
| **録音形式** | m4a (AAC) | webm (Opus) |
| **開発チーム** | 独立可 | 独立可 |

### 9.3 共通基盤

| 項目 | 内容 |
|-----|------|
| **認証** | Firebase Auth（同一プロジェクト） |
| **ストレージ** | Firebase Storage（同一バケット） |
| **処理エンジン** | Cloud Run |
| **文字起こし** | Gemini API |

---

## 10. 結論

### 10.1 最終推奨

| 項目 | 推奨 |
|-----|------|
| **アーキテクチャ** | バックエンド共通パターン |
| **クラウド** | Firebase + Cloud Run |
| **iPhoneアプリ** | Firebase iOS SDK |
| **Webアプリ** | Firebase Web SDK + React/Next.js |

### 10.2 v2からの変更点

| 項目 | v2 | v3 |
|-----|----|----|
| 前提 | 統合プロジェクト | **iPhone/Web別プロジェクト** |
| 結論 | Firebase + Cloud Run | **同じ（バックエンド共通推奨）** |
| 追加考慮 | - | **独立開発のしやすさを評価に追加** |

### 10.3 コストサマリー

| 年度 | 月額 | 年額 |
|-----|------|------|
| 2026年 | $93-130 | $1,116-1,560 |
| 2027年 | $186-260 | $2,232-3,120 |

### 10.4 次のステップ

| 順序 | 作業 | 担当 |
|-----|------|------|
| 1 | Firebase プロジェクト作成 | 共通 |
| 2 | Cloud Run 処理エンジン構築 | 共通 |
| 3 | Eventarc トリガー設定 | 共通 |
| 4 | iPhoneアプリ Firebase SDK統合 | iPhoneチーム |
| 5 | Webアプリ新規開発 | Webチーム |

> **ポイント**: Step 1-3 を先に完了すれば、Step 4 と Step 5 は**並行開発可能**

---

## 11. 代替案

### 11.1 完全分離が必要な場合

iPhoneとWebで**完全にデータを分けたい**場合:

| クライアント | 推奨構成 | 月額(2026) |
|------------|---------|-----------|
| iPhone | Firebase + Cloud Run | $47-65 |
| Web | Supabase + Cloud Run | $47-65 |
| **合計** | | **$94-130** |

> コストはほぼ同じだが、ユーザーデータが分断されるデメリットあり

### 11.2 コスト最優先の場合

| 構成 | 月額(2026) | トレードオフ |
|-----|-----------|-------------|
| AWS S3 + ECS Fargate | $39-76 | 実装複雑、Gemini連携に一手間 |

---

**以上**
